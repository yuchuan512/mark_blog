title: 网路知识小结
date: 2016-09-28 10:03:43
categories:
tags:
---
以太网：CSMA/CD协议。载波监听、多点接入、碰撞检测

IP地址和MAC地址
网络层以上使用IP地址, 数据链路层以下使用MAC地址
IP地址是逻辑地址, MAC地址是物理地址
IP分组中首部的源地址和目的地址在传输中不会改变, MAC帧中首部的源地址和目的地址每到一个路由器会改变一次

A类地址 : 0.0.0.0 ~ 127.0.0.0   0开头
B类地址 : 128.0.0.0 ~ 191.255.0.0   10开头
C类地址 : 192.0.0.0 ~ 223.255.255.0  110 开头

A类地址的默认子网掩码为255.0.0.0
B类地址的默认子网掩码为255.255.0.0
C类地址的默认子网掩码为255.255.255.0

使用网络前缀，五分类域间路由选择CIDR。 128.14.35.7/20, 意思是前20位为网络前缀, 后12位为主机号

三次握手四次挥手
![TCP三次握手四次挥手](http://i1.piimg.com/567571/72de7084fd0f7a2b.jpg)

TCP三次握手四次挥手
![TCP三次握手四次挥手](http://i1.piimg.com/567571/72de7084fd0f7a2b.jpg)
> 假设Client端发起中断连接请求，也就是发送FIN报文。Server端接到FIN报文后，意思是说"我Client端没有数据要发给你了"，但是如果你还有数据没有发送完成，则不必急着关闭Socket，可以继续发送数据。所以你先发送ACK，"告诉Client端，你的请求我收到了，但是我还没准备好，请继续你等我的消息"。这个时候Client端就进入FIN_WAIT状态，继续等待Server端的FIN报文。当Server端确定数据已发送完成，则向Client端发送FIN报文，"告诉Client端，好了，我这边数据发完了，准备好关闭连接了"。Client端收到FIN报文后，"就知道可以关闭连接了，但是他还是不相信网络，怕Server端不知道要关闭，所以发送ACK后进入TIME_WAIT状态，如果Server端没有收到ACK则可以重传。“，Server端收到ACK后，"就知道可以断开连接了"。Client端等待了2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，我Client端也可以关闭连接了。Ok，TCP连接就这样关闭了！

![建立连接](http://i4.buimg.com/567571/3c8b9789b38ce92d.png)

![释放连接](http://i4.buimg.com/567571/f240a7f8cf95eef8.png)
> 在TIME_WAIT状态中，如果TCP client端最后一次发送的ACK丢失了，它将重新发送。TIME_WAIT状态中所需要的时间是依赖于实现方法的。典型的值为30秒、1分钟和2分钟。等待之后连接正式关闭，并且所有的资源(包括端口号)都被释放。

 * 为什么连接的时候是三次握手，关闭的时候却是四次握手？
答：因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，"你发的FIN报文我收到了"。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。
 * 为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？
答：虽然按道理，四个报文都发送完毕，我们可以直接进入CLOSE状态了，但是我们必须假象网络是不可靠的，有可以最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。

### mentohust安装
sudo mentohust -uusername -p123456 -a1 -d2 -b2 -v4.10 -w
退出认证使用sudo mentohust -k或pkill mentohust，
sudo dpkg -i mentohust_0.3.4-1_i386.deb





